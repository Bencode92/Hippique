<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Le reste du head reste inchangé -->
</head>
<body>
    <!-- Le reste du contenu HTML reste inchangé jusqu'à la section qui nous intéresse -->

    <script>
        // Reste du script inchangé jusqu'à la section où les scores prédictifs sont affichés
        
        // Dans la fonction toggleCourseDetails, partie qui génère le HTML pour les participants:
        
        participantsTries.forEach((resultat, index) => {
            const participant = resultat.participant;
            const scorePredictif = resultat.scorePredictif;
            
            // Réduire la taille de certaines colonnes si le texte est trop long
            const propietaire = getPropertyValue(participant, [
                "proprietaire", "propriétaire", "proprio", "owner", "owner_name"
            ]) || "N/A";
            
            const eleveurs = getPropertyValue(participant, [
                "eleveurs", "éleveurs", "eleveur", "éleveur", "breeder", "breeder_name"
            ]) || "N/A";
            
            // Calculer une couleur de fond pour la barre de score
            const score = parseFloat(scorePredictif.score);
            const normalizedScore = Math.min(Math.max(0, score), 100) / 100; // 0 à 1
            
            // MODIFICATION: Calcul dynamique du score NC basé sur l'indice de confiance
            let scoreDisplay = scorePredictif.score;
            let confidenceDisplay = '';
            
            // Détecter si c'est un NC (pas dans le classement)
            if (participant.status === 'NC' || 
                (scorePredictif.details.cheval.rang === "NC" && 
                 scorePredictif.details.jockey.rang === "NC")) {
                // Calcul basé sur l'indice de confiance
                const confIndex = parseFloat(scorePredictif.indiceConfiance || 0.5);
                const basePoints = 15.0; // Points de base pour un NC
                const adjustedPoints = basePoints * (1 + confIndex);
                
                // Formater le score avec 1 décimale
                scoreDisplay = adjustedPoints.toFixed(1) + " pts";
                
                // Déterminer la classe de confiance
                let confidenceClass = 'confidence-low';
                if (confIndex >= 0.7) {
                    confidenceClass = 'confidence-high';
                } else if (confIndex >= 0.4) {
                    confidenceClass = 'confidence-medium';
                }
                
                confidenceDisplay = `<span class="confidence-indicator ${confidenceClass}">${Math.round(confIndex * 100)}% fiable</span>`;
            } else {
                // Score normal pour les participants avec classement
                scoreDisplay = scorePredictif.score + " pts";
                
                // Indice de confiance avec classe de style
                const confidence = scorePredictif.indiceConfiance ? parseFloat(scorePredictif.indiceConfiance) : 0;
                let confidenceClass = 'confidence-low';
                if (confidence >= 0.8) {
                    confidenceClass = 'confidence-high';
                } else if (confidence >= 0.5) {
                    confidenceClass = 'confidence-medium';
                }
                
                confidenceDisplay = scorePredictif.indiceConfiance ? 
                    `<span class="confidence-indicator ${confidenceClass}">${Math.round(parseFloat(scorePredictif.indiceConfiance) * 100)}% fiable</span>` : 
                    '';
            }
            
            participantsHTML += `
                <tr data-score="${scorePredictif.score}" data-numero="${participant.numero || 0}">
                    <td style="text-align: center;">
                        <div class="horse-number">${participant.numero || '-'}</div>
                    </td>
                    <td>${participant.cheval || 'N/A'}</td>
                    <td>${participant.jockey || 'N/A'}</td>
                    <td>${participant.entraineur || 'N/A'}</td>
                    <td>${propietaire.length > 20 ? propietaire.slice(0, 20) + '...' : propietaire}</td>
                    <td>${eleveurs.length > 20 ? eleveurs.slice(0, 20) + '...' : eleveurs}</td>
                    <td>${participant.poids || 'N/A'}</td>
                    <td class="prediction-cell">
                        <div class="prediction-bar-container">
                            <div class="prediction-bar" style="width: ${normalizedScore * 100}%;"></div>
                            <div class="prediction-value">${scoreDisplay}</div>
                        </div>
                        <div class="score-details">
                            <small>
                                Détails <i class="fas fa-info-circle"></i>
                                ${confidenceDisplay}
                            </small>
                            <div class="tooltip-content">
                                <p>Cheval: Rang #${scorePredictif.details.cheval.rang} (${scorePredictif.details.cheval.score} pts)</p>
                                <p>Jockey: Rang #${scorePredictif.details.jockey.rang} (${scorePredictif.details.jockey.score} pts)</p>
                                <p>Entraîneur: Rang #${scorePredictif.details.entraineur.rang} (${scorePredictif.details.entraineur.score} pts)</p>
                                <p>Éleveur: Rang #${scorePredictif.details.eleveur.rang} (${scorePredictif.details.eleveur.score} pts)</p>
                                <p>Propriétaire: Rang #${scorePredictif.details.proprietaire.rang} (${scorePredictif.details.proprietaire.score} pts)</p>
                                ${scorePredictif.indiceConfiance ? 
                                  `<p><strong>Fiabilité: ${Math.round(parseFloat(scorePredictif.indiceConfiance) * 100)}%</strong> (${getConfidenceDescription(parseFloat(scorePredictif.indiceConfiance))})</p>` : 
                                  ''}
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        });
        
        // Le reste du script reste inchangé
    </script>
    
    <!-- Ajout du nouveau module ranking-loader.js -->
    <script src="js/ranking-loader.js?v=1"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse Hippique - Système de Scoring</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Palette de couleurs personnalisée */
        :root {
            --grass-green: #0b8043;  /* Vert gazon */
            --dark-green: #085c2f;   /* Vert gazon foncé */
            --gold: #d4af37;         /* Or */
            --light-gold: #f6e9ba;   /* Or clair */
            --black: #1a1a1a;        /* Noir légèrement atténué */
        }
        
        body {
            background-color: #f5f5f5;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--gold);
        }
        
        .gradient-background {
            background: linear-gradient(to right, var(--dark-green), var(--grass-green));
        }
        
        .score-pill {
            transition: all 0.3s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .horse-card {
            transition: all 0.3s ease;
            border: 1px solid #eaeaea;
        }
        
        .horse-card:hover {
            border-color: var(--gold);
        }
        
        .horse-card:hover .horse-image {
            transform: scale(1.05);
        }
        
        .horse-image {
            transition: all 0.3s ease;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .gold-text {
            color: var(--gold);
        }
        
        .simulation-badge {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="gradient-background text-white py-6 shadow-lg">
        <div class="container mx-auto px-4 flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center mb-4 md:mb-0">
                <i class="fas fa-horse-head text-3xl mr-3" style="color: var(--gold);"></i>
                <h1 class="text-3xl font-bold">Analyse <span style="color: var(--gold);">Hippique</span></h1>
            </div>
            <div class="flex flex-col md:flex-row items-center">
                <div class="relative mb-4 md:mb-0 md:mr-4">
                    <input id="search" type="text" placeholder="Rechercher un cheval, jockey, entraîneur..." 
                           class="bg-black bg-opacity-20 rounded-full py-2 px-4 pl-10 w-64 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white placeholder-gray-300">
                    <i class="fas fa-search absolute left-3 top-3" style="color: var(--gold);"></i>
                </div>
                <select id="category-filter" class="bg-black bg-opacity-20 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-white" style="border: 1px solid var(--gold);">
                    <option value="all">Toutes les catégories</option>
                    <option value="chevaux">Chevaux</option>
                    <option value="jockeys">Jockeys</option>
                    <option value="entraineurs">Entraîneurs</option>
                    <option value="proprietaires">Propriétaires</option>
                    <option value="eleveurs">Éleveurs</option>
                </select>
            </div>
        </div>
    </header>

    <div id="status-indicator" class="fixed top-4 right-4 z-50 bg-black bg-opacity-80 text-white p-2 rounded-md flex items-center text-sm" style="display: none;">
        <div class="loading mr-2"></div>
        <span id="status-text">Chargement des données...</span>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Dashboard Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-md p-6 card-hover border border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-700">Courses Analysées</h3>
                    <i class="fas fa-flag-checkered text-2xl" style="color: var(--grass-green);"></i>
                </div>
                <p id="courses-count" class="text-3xl font-bold mt-2 text-gray-800">--</p>
                <div class="flex items-center mt-1 text-sm">
                    <span class="text-green-600 flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i>12%
                    </span>
                    <span class="text-gray-500 ml-2">vs semaine précédente</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 card-hover border border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-700">Chevaux</h3>
                    <i class="fas fa-horse text-2xl" style="color: var(--grass-green);"></i>
                </div>
                <p id="chevaux-count" class="text-3xl font-bold mt-2 text-gray-800">--</p>
                <div class="flex items-center mt-1 text-sm">
                    <span class="text-green-600 flex items-center">
                        <i class="fas fa-arrow-up mr-1"></i>8%
                    </span>
                    <span class="text-gray-500 ml-2">Nouvelles entrées</span>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 card-hover border border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-700">Jockeys</h3>
                    <i class="fas fa-user text-2xl" style="color: var(--grass-green);"></i>
                </div>
                <p id="jockeys-count" class="text-3xl font-bold mt-2 text-gray-800">--</p>
                <div class="flex items-center mt-1 text-sm">
                    <span class="text-gray-500">Performance moyenne:</span>
                    <div class="ml-2 w-24 bg-gray-200 rounded-full h-2">
                        <div class="h-2 rounded-full" style="width: 75%; background-color: var(--grass-green);"></div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 card-hover border border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-700">Gains Moyens</h3>
                    <i class="fas fa-euro-sign text-2xl" style="color: var(--gold);"></i>
                </div>
                <p id="gains-moyens" class="text-3xl font-bold mt-2 text-gray-800">--</p>
                <div class="flex items-center mt-1 text-sm">
                    <span class="text-red-500 flex items-center">
                        <i class="fas fa-arrow-down mr-1"></i>3%
                    </span>
                    <span class="text-gray-500 ml-2">Par course gagnée</span>
                </div>
            </div>
        </div>
        
        <!-- Course Selector -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8 border border-gray-200">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Sélectionner une course à analyser</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-2">
                    <div class="flex flex-col space-y-4">
                        <div class="flex space-x-4">
                            <select id="hippodrome-select" class="bg-gray-100 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 border border-gray-300 flex-grow" style="border-color: var(--grass-green);">
                                <option value="">Choisir un hippodrome</option>
                                <option value="longchamp">ParisLongchamp</option>
                                <option value="chantilly">Chantilly</option>
                                <option value="deauville">Deauville</option>
                                <option value="saint-cloud">Saint-Cloud</option>
                                <option value="auteuil">Auteuil</option>
                            </select>
                            <input type="date" id="course-date" class="bg-gray-100 rounded-lg py-2 px-4 focus:outline-none focus:ring-2 border border-gray-300 flex-grow" style="border-color: var(--grass-green);" value="2025-04-15">
                        </div>
                        
                        <select id="course-select" class="bg-gray-100 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 border border-gray-300" style="border-color: var(--grass-green);">
                            <option value="">Sélectionner une course</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex items-end">
                    <button id="analyze-button" class="w-full text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center" style="background-color: var(--grass-green); box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                        <i class="fas fa-chart-line mr-2"></i> Analyser la course
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Selection des participants -->
        <div id="selection-participants" class="bg-white rounded-xl shadow-md p-6 mb-8 border border-gray-200" style="display: none;">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Sélectionner les participants</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Sélection chevaux -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Chevaux</h3>
                    <div id="chevaux-selection" class="space-y-2 max-h-48 overflow-y-auto p-2 border rounded-lg">
                        <!-- Les chevaux seront ajoutés ici dynamiquement -->
                        <div class="text-center text-gray-500 py-2">Chargement...</div>
                    </div>
                </div>
                
                <!-- Sélection jockeys et entraîneurs -->
                <div class="space-y-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Jockeys</h3>
                        <div id="jockeys-selection" class="space-y-2 max-h-24 overflow-y-auto p-2 border rounded-lg">
                            <!-- Les jockeys seront ajoutés ici dynamiquement -->
                            <div class="text-center text-gray-500 py-2">Chargement...</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Entraîneurs</h3>
                        <div id="entraineurs-selection" class="space-y-2 max-h-24 overflow-y-auto p-2 border rounded-lg">
                            <!-- Les entraîneurs seront ajoutés ici dynamiquement -->
                            <div class="text-center text-gray-500 py-2">Chargement...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button id="calculate-button" class="text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center" style="background-color: var(--gold); box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                    <i class="fas fa-calculator mr-2"></i> Calculer les scores
                </button>
            </div>
        </div>
        
        <!-- Course Analysis Results -->
        <div id="analysis-results" class="mb-8 fade-in" style="display: none;">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Résultats d'analyse: <span id="course-title" style="color: var(--gold);">Prix du Bois de Boulogne</span></h2>
            
            <!-- Score Formula Explanation -->
            <div class="p-4 mb-6 rounded-r-lg border-l-4" style="background-color: rgba(212, 175, 55, 0.1); border-color: var(--gold);">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-xl" style="color: var(--gold);"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium" style="color: var(--black);">Formula de scoring</p>
                        <p class="text-sm" style="color: var(--black);">Score = (0.4 × Performance Cheval) + (0.25 × Performance Jockey) + (0.2 × Performance Entraîneur) + (0.15 × Performance Propriétaire)</p>
                    </div>
                </div>
            </div>
            
            <!-- Horses Grid -->
            <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Les cartes de résultats seront ajoutées ici -->
            </div>
            
            <!-- Detailed Stats Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-md p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Comparaison des scores</h3>
                    <canvas id="scoresChart" height="300"></canvas>
                </div>
                
                <div class="bg-white rounded-xl shadow-md p-6 border border-gray-200">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Comparaison des performances</h3>
                    <canvas id="performanceChart" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Data Visualization Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2 bg-white rounded-xl shadow-md p-6 border border-gray-200">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Tendances de performance</h2>
                <canvas id="trendsChart" height="250"></canvas>
            </div>
            
            <div class="bg-white rounded-xl shadow-md p-6 border border-gray-200">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Top Jockeys</h2>
                <div id="top-jockeys" class="space-y-4">
                    <!-- Les jockeys seront ajoutés ici dynamiquement -->
                    <div class="text-center text-gray-500 py-4">Chargement des données...</div>
                </div>
            </div>
        </div>
    </div>

    <footer class="gradient-background text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fas fa-horse-head text-2xl mr-3" style="color: var(--gold);"></i>
                        <h2 class="text-xl font-bold">Analyse <span style="color: var(--gold);">Hippique</span></h2>
                    </div>
                    <p class="text-sm mt-2">Système d'analyse de performances hippiques</p>
                </div>
                
                <div class="flex space-x-4">
                    <a href="#" class="text-white hover:text-yellow-400 transition duration-300">
                        <i class="fab fa-twitter text-xl"></i>
                    </a>
                    <a href="#" class="text-white hover:text-yellow-400 transition duration-300">
                        <i class="fab fa-facebook text-xl"></i>
                    </a>
                    <a href="#" class="text-white hover:text-yellow-400 transition duration-300">
                        <i class="fab fa-instagram text-xl"></i>
                    </a>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-6 pt-6 text-sm text-center md:text-left">
                <p>&copy; 2025 Analyse Hippique. Tous droits réservés.</p>
            </div>
        </div>
    </footer>
    
    <script>
        // Stockage de données globales
        const appData = {
            chevaux: [],
            jockeys: [],
            entraineurs: [],
            proprietaires: [],
            eleveurs: [],
            selectedCourse: null,
            selectedParticipants: [],
            resultsData: []
        };
        
        // Utilitaires
        function showStatus(message) {
            document.getElementById('status-text').textContent = message;
            document.getElementById('status-indicator').style.display = 'flex';
        }
        
        function hideStatus() {
            document.getElementById('status-indicator').style.display = 'none';
        }
        
        function formatNumber(num) {
            return new Intl.NumberFormat('fr-FR').format(num);
        }
        
        // Génère une valeur aléatoire entre min et max avec une tendance vers avg
        function getRandomValue(min, max, avg) {
            const rand = Math.random();
            const weight = 0.7; // Plus la valeur est élevée, plus la tendance vers avg est forte
            return Math.round(((1 - weight) * (min + rand * (max - min))) + (weight * avg));
        }
        
        // Fonction pour charger les données JSON
        async function loadData() {
            showStatus('Chargement des données...');
            
            try {
                // Charger les données pour chaque catégorie
                const categories = ['chevaux', 'jockeys', 'entraineurs', 'proprietaires', 'eleveurs'];
                const promises = categories.map(category => 
                    fetch(`data/${category}.json`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Erreur de chargement pour ${category}`);
                        }
                        return response.json();
                    })
                );
                
                const results = await Promise.all(promises);
                
                // Stocker les données
                categories.forEach((category, index) => {
                    appData[category] = results[index].resultats || [];
                    console.log(`Chargé ${appData[category].length} ${category}`);
                });
                
                // Mettre à jour l'interface
                updateDashboardStats();
                populateCourseSelector();
                populateParticipantsSelection();
                populateTopJockeys();
                
                hideStatus();
                return true;
            } catch (error) {
                console.error("Erreur lors du chargement des données:", error);
                showStatus(`Erreur: ${error.message}`);
                
                // En cas d'erreur, charger des données de démonstration
                loadDemoData();
                return false;
            }
        }
        
        // Fonction pour charger des données de démonstration si l'API échoue
        function loadDemoData() {
            console.log("Chargement des données de démonstration");
            
            // Génération de données de démonstration
            appData.chevaux = generateDemoHorses(150);
            appData.jockeys = generateDemoJockeys(30);
            appData.entraineurs = generateDemoTrainers(25);
            appData.proprietaires = generateDemoOwners(40);
            
            // Mettre à jour l'interface
            updateDashboardStats();
            populateCourseSelector();
            populateParticipantsSelection();
            populateTopJockeys();
            
            hideStatus();
            
            // Afficher un message indiquant que ce sont des données de démonstration
            const demoIndicator = document.createElement('div');
            demoIndicator.className = 'simulation-badge';
            demoIndicator.textContent = 'Données de démonstration';
            document.body.appendChild(demoIndicator);
        }
        
        // Générer des données de démonstration
        function generateDemoHorses(count) {
            const names = ["Pegasus", "Thunder", "Eclipse", "Spirit", "Midnight", "Shadow", "Phoenix", "Blaze", "Arrow", "Comet", 
                           "King George", "Royal Eagle", "Silver Star", "Storm Runner", "Golden Mile", "Dark Knight", "Diamond Dust", 
                           "Lucky Strike", "Rapid Fire", "Wind Dancer", "Star Gazer", "Black Beauty", "Champion", "Victory Lap"];
            const races = ["PUR SANG", "AQPS", "TROTTEUR FRANÇAIS"];
            const sexes = ["M", "F", "H"];
            
            const horses = [];
            for (let i = 0; i < count; i++) {
                const firstName = names[Math.floor(Math.random() * names.length)];
                const lastName = names[Math.floor(Math.random() * names.length)];
                const name = Math.random() > 0.5 ? firstName : `${firstName} ${lastName}`;
                
                const nbVictoires = Math.floor(Math.random() * 10);
                const nbPlaces = Math.floor(Math.random() * 15);
                const nbCourses = nbVictoires + nbPlaces + Math.floor(Math.random() * 10);
                
                horses.push({
                    LibelleCheval: name.toUpperCase(),
                    Age: 3 + Math.floor(Math.random() * 8),
                    Sexe: sexes[Math.floor(Math.random() * sexes.length)],
                    Race: races[Math.floor(Math.random() * races.length)],
                    NbCourses: nbCourses,
                    NbVictoires: nbVictoires,
                    NbPlace: nbPlaces,
                    AllocTotale: Math.round(Math.random() * 100 * 100) / 100,
                    Valeur: 30 + Math.floor(Math.random() * 30)
                });
            }
            return horses;
        }
        
        function generateDemoJockeys(count) {
            const firstNames = ["Maxime", "Christophe", "Olivier", "Mickael", "Pierre-Charles", "Frankie", "Ryan", "Jean", "Thomas", "Vincent"];
            const lastNames = ["Guyon", "Soumillon", "Peslier", "Barzalona", "Boudot", "Dettori", "Moore", "Martin", "Durand", "Leclerc"];
            
            const jockeys = [];
            for (let i = 0; i < count; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                
                const nbVictoires = Math.floor(Math.random() * 100);
                const nbPlaces = Math.floor(Math.random() * 150);
                const nbCourses = nbVictoires + nbPlaces + Math.floor(Math.random() * 100);
                
                jockeys.push({
                    Jockey: `${lastName.toUpperCase()} ${firstName}`,
                    Courses: nbCourses,
                    Victoires: nbVictoires,
                    Places: nbPlaces,
                    TotalAllocations: Math.round(Math.random() * 1000 * 100) / 100
                });
            }
            return jockeys;
        }
        
        function generateDemoTrainers(count) {
            const firstNames = ["André", "Francis", "Jean-Claude", "Alain", "Freddy", "Carlos", "Yann", "Stephane", "Henri", "Guillaume"];
            const lastNames = ["Fabre", "Head", "Rouget", "Royer-Dupré", "Lerner", "Laffon-Parias", "Clément", "Wattel", "Pantall", "Macaire"];
            
            const trainers = [];
            for (let i = 0; i < count; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                
                const nbVictoires = Math.floor(Math.random() * 150);
                const nbPlaces = Math.floor(Math.random() * 200);
                const nbCourses = nbVictoires + nbPlaces + Math.floor(Math.random() * 150);
                
                trainers.push({
                    Entraineur: `${lastName.toUpperCase()} ${firstName}`,
                    Courses: nbCourses,
                    Victoires: nbVictoires,
                    Places: nbPlaces,
                    TotalAllocations: Math.round(Math.random() * 2000 * 100) / 100
                });
            }
            return trainers;
        }
        
        function generateDemoOwners(count) {
            const names = ["GODOLPHIN SNC", "WERTHEIMER & FRERE", "AL SHAQAB RACING", "JUDDMONTE FARMS", "OTI MANAGEMENT", 
                          "ECURIE DES MONCEAUX", "COOLMORE", "SHEIKH MOHAMMED", "ECURIE ENDERS", "ECURIE VALOR"];
            
            const owners = [];
            for (let i = 0; i < count; i++) {
                let name;
                if (i < names.length) {
                    name = names[i];
                } else {
                    name = "ECURIE " + Math.random().toString(36).substring(2, 8).toUpperCase();
                }
                
                const nbVictoires = Math.floor(Math.random() * 80);
                const nbPlaces = Math.floor(Math.random() * 120);
                const nbCourses = nbVictoires + nbPlaces + Math.floor(Math.random() * 100);
                
                owners.push({
                    Proprietaire: name,
                    Courses: nbCourses,
                    Victoires: nbVictoires,
                    Places: nbPlaces,
                    TotalAllocations: Math.round(Math.random() * 3000 * 100) / 100
                });
            }
            return owners;
        }
        
        // Mise à jour des statistiques du tableau de bord
        function updateDashboardStats() {
            document.getElementById('chevaux-count').textContent = appData.chevaux.length;
            document.getElementById('jockeys-count').textContent = appData.jockeys.length;
            
            // Calculer la moyenne des gains si disponible
            if (appData.chevaux.length > 0 && appData.chevaux[0].AllocTotale) {
                let totalAlloc = 0;
                let count = 0;
                
                appData.chevaux.forEach(cheval => {
                    if (cheval.AllocTotale) {
                        totalAlloc += parseFloat(cheval.AllocTotale);
                        count++;
                    }
                });
                
                const gainsMoyens = count > 0 ? totalAlloc / count : 0;
                document.getElementById('gains-moyens').textContent = formatNumber(Math.round(gainsMoyens * 1000)) + ' €';
            } else {
                document.getElementById('gains-moyens').textContent = formatNumber(Math.round(Math.random() * 15000)) + ' €';
            }
            
            // Nombre approximatif de courses basé sur le nombre total de participations
            let totalCourses = 0;
            if (appData.chevaux.length > 0 && appData.chevaux[0].NbCourses) {
                totalCourses = appData.chevaux.reduce((sum, cheval) => sum + (parseInt(cheval.NbCourses) || 0), 0) / 8;
            } else {
                totalCourses = Math.floor(100 + Math.random() * 50);
            }
            
            document.getElementById('courses-count').textContent = Math.round(totalCourses);
        }
        
        // Remplir le sélecteur de course
        function populateCourseSelector() {
            const courseSelect = document.getElementById('course-select');
            courseSelect.innerHTML = '<option value="">Sélectionner une course</option>';
            
            // Générer des courses fictives
            const coursesData = [
                { id: 'course1', name: 'Prix de la Porte Maillot', distance: 1400, type: 'Handicap', time: '16:25' },
                { id: 'course2', name: 'Prix du Bois de Boulogne', distance: 2400, type: 'Groupe 3', time: '17:00' },
                { id: 'course3', name: 'Grand Prix de Paris', distance: 2100, type: 'Groupe 1', time: '17:35' },
                { id: 'course4', name: 'Prix de Diane', distance: 2100, type: 'Groupe 1', time: '15:15' },
                { id: 'course5', name: 'Prix du Jockey Club', distance: 2100, type: 'Groupe 1', time: '14:50' },
                { id: 'course6', name: 'Prix Niel', distance: 2400, type: 'Groupe 2', time: '16:45' }
            ];
            
            // Ajouter chaque course au sélecteur
            coursesData.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = `${course.name} - ${course.time} - ${course.distance}m - ${course.type}`;
                option.dataset.courseName = course.name;
                courseSelect.appendChild(option);
            });
            
            // Événement de changement pour afficher la section participants
            courseSelect.addEventListener('change', function() {
                if (this.value) {
                    const selectedOption = this.options[this.selectedIndex];
                    appData.selectedCourse = {
                        id: this.value,
                        name: selectedOption.dataset.courseName,
                        full: selectedOption.textContent
                    };
                    document.getElementById('selection-participants').style.display = 'block';
                } else {
                    document.getElementById('selection-participants').style.display = 'none';
                }
            });
        }
        
        // Remplir la sélection des participants
        function populateParticipantsSelection() {
            const chevauxContainer = document.getElementById('chevaux-selection');
            const jockeysContainer = document.getElementById('jockeys-selection');
            const entraineursContainer = document.getElementById('entraineurs-selection');
            
            // Vider les conteneurs
            chevauxContainer.innerHTML = '';
            jockeysContainer.innerHTML = '';
            entraineursContainer.innerHTML = '';
            
            // Limit to a reasonable number of items
            const chevauxToShow = appData.chevaux.slice(0, 20);
            const jockeysToShow = appData.jockeys.slice(0, 15);
            const entraineursToShow = appData.entraineurs.slice(0, 15);
            
            // Ajouter les chevaux
            chevauxToShow.forEach(cheval => {
                const div = document.createElement('div');
                div.className = 'flex items-center p-2 hover:bg-gray-100 rounded cursor-pointer';
                div.innerHTML = `
                    <input type="checkbox" class="cheval-checkbox mr-2" data-id="${cheval.LibelleCheval}" 
                           data-valeur="${cheval.Valeur || Math.floor(30 + Math.random() * 30)}">
                    <div>
                        <div class="font-semibold">${cheval.LibelleCheval}</div>
                        <div class="text-xs text-gray-500">${cheval.Sexe} - ${cheval.Age} ans</div>
                    </div>
                `;
                chevauxContainer.appendChild(div);
            });
            
            // Ajouter les jockeys
            jockeysToShow.forEach(jockey => {
                const div = document.createElement('div');
                div.className = 'flex items-center p-2 hover:bg-gray-100 rounded cursor-pointer';
                
                // Calculer une valeur de performance basée sur les victoires/courses
                const performance = jockey.Victoires && jockey.Courses 
                    ? Math.round((jockey.Victoires / jockey.Courses) * 100 * 1.5) 
                    : Math.floor(60 + Math.random() * 40);
                
                div.innerHTML = `
                    <input type="checkbox" class="jockey-checkbox mr-2" data-id="${jockey.Jockey}" 
                           data-performance="${performance}">
                    <div class="font-semibold">${jockey.Jockey}</div>
                `;
                jockeysContainer.appendChild(div);
            });
            
            // Ajouter les entraîneurs
            entraineursToShow.forEach(entraineur => {
                const div = document.createElement('div');
                div.className = 'flex items-center p-2 hover:bg-gray-100 rounded cursor-pointer';
                
                // Calculer une valeur de performance basée sur les victoires/courses
                const performance = entraineur.Victoires && entraineur.Courses 
                    ? Math.round((entraineur.Victoires / entraineur.Courses) * 100 * 1.8) 
                    : Math.floor(65 + Math.random() * 35);
                
                div.innerHTML = `
                    <input type="checkbox" class="entraineur-checkbox mr-2" data-id="${entraineur.Entraineur}" 
                           data-performance="${performance}">
                    <div class="font-semibold">${entraineur.Entraineur}</div>
                `;
                entraineursContainer.appendChild(div);
            });
            
            // Ajouter événement pour le bouton de calcul
            document.getElementById('calculate-button').addEventListener('click', function() {
                calculateAndDisplayResults();
            });
        }
        
        // Remplir le top des jockeys
        function populateTopJockeys() {
            const topJockeysContainer = document.getElementById('top-jockeys');
            topJockeysContainer.innerHTML = '';
            
            // Trier les jockeys par performances (victoires/courses)
            let sortedJockeys = [...appData.jockeys];
            
            if (sortedJockeys.length > 0 && sortedJockeys[0].Victoires) {
                sortedJockeys.sort((a, b) => {
                    const ratioA = a.Victoires / (a.Courses || 1);
                    const ratioB = b.Victoires / (b.Courses || 1);
                    return ratioB - ratioA;
                });
            } else {
                // Données de démo
                sortedJockeys = [
                    { Jockey: "GUYON MAXIME", performance: 92 },
                    { Jockey: "SOUMILLON CHRISTOPHE", performance: 88 },
                    { Jockey: "PESLIER OLIVIER", performance: 85 },
                    { Jockey: "BARZALONA MICKAEL", performance: 82 },
                    { Jockey: "BOUDOT PIERRE-CHARLES", performance: 80 }
                ];
            }
            
            // Afficher les 5 premiers jockeys
            const topJockeys = sortedJockeys.slice(0, 5);
            
            topJockeys.forEach((jockey, index) => {
                // Calculer une performance entre 80 et 95
                const performance = jockey.performance || 
                    Math.round((jockey.Victoires / (jockey.Courses || 1)) * 100 * 1.5) || 
                    (95 - index * 3);
                
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3" style="background-color: var(--light-gold);">
                        <span class="font-bold" style="color: var(--black);">${index + 1}</span>
                    </div>
                    <div class="flex-grow">
                        <h3 class="font-semibold">${jockey.Jockey}</h3>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="h-2 rounded-full" style="width: ${performance}%; background-color: var(--grass-green);"></div>
                        </div>
                    </div>
                    <div class="ml-3 font-bold">${performance}</div>
                `;
                topJockeysContainer.appendChild(div);
            });
        }
        
        // Calculer et afficher les résultats
        function calculateAndDisplayResults() {
            showStatus('Calcul des résultats...');
            
            // Récupérer les chevaux sélectionnés
            const selectedChevauxElements = document.querySelectorAll('.cheval-checkbox:checked');
            const selectedJockeysElements = document.querySelectorAll('.jockey-checkbox:checked');
            const selectedEntraineursElements = document.querySelectorAll('.entraineur-checkbox:checked');
            
            if (selectedChevauxElements.length === 0) {
                alert('Veuillez sélectionner au moins un cheval');
                hideStatus();
                return;
            }
            
            // Réinitialiser les résultats
            appData.resultsData = [];
            
            // Créer des paires cheval-jockey-entraineur
            const selectedChevauxArray = Array.from(selectedChevauxElements);
            const selectedJockeysArray = Array.from(selectedJockeysElements);
            const selectedEntraineursArray = Array.from(selectedEntraineursElements);
            
            // Créer des combinaisons
            selectedChevauxArray.forEach((chevalEl, index) => {
                const chevalId = chevalEl.dataset.id;
                const chevalValeur = parseInt(chevalEl.dataset.valeur);
                
                // Attribuer jockey et entraineur (cycliquement ou au hasard si pas assez)
                const jockeyEl = selectedJockeysArray.length > 0 
                    ? selectedJockeysArray[index % selectedJockeysArray.length] 
                    : null;
                    
                const entraineurEl = selectedEntraineursArray.length > 0 
                    ? selectedEntraineursArray[index % selectedEntraineursArray.length] 
                    : null;
                
                // Générer un propriétaire aléatoire
                const proprietaire = appData.proprietaires.length > 0 
                    ? appData.proprietaires[Math.floor(Math.random() * appData.proprietaires.length)].Proprietaire
                    : "ECURIE " + Math.random().toString(36).substring(2, 8).toUpperCase();
                
                // Calculer les performances et le score
                const chevalPerformance = getRandomValue(65, 98, chevalValeur);
                const jockeyPerformance = jockeyEl ? parseInt(jockeyEl.dataset.performance) : getRandomValue(70, 95, 85);
                const entraineurPerformance = entraineurEl ? parseInt(entraineurEl.dataset.performance) : getRandomValue(70, 95, 85);
                const proprietairePerformance = getRandomValue(70, 98, 85);
                
                // Formula: 0.4*cheval + 0.25*jockey + 0.2*entraineur + 0.15*proprietaire
                const score = Math.round(
                    (0.4 * chevalPerformance) + 
                    (0.25 * jockeyPerformance) + 
                    (0.2 * entraineurPerformance) + 
                    (0.15 * proprietairePerformance)
                );
                
                // Générer un historique aléatoire
                const historique = [];
                for (let i = 0; i < 5; i++) {
                    const place = Math.floor(Math.random() * 10) + 1;
                    historique.push(place);
                }
                
                // Calculer la cote en fonction inverse du score
                const cote = Math.round((110 - score) / 10 * 10) / 10;
                
                // Ajouter aux résultats
                appData.resultsData.push({
                    nom: chevalId,
                    age: Math.floor(Math.random() * 6) + 3,
                    sexe: ['M', 'F', 'H'][Math.floor(Math.random() * 3)],
                    jockey: jockeyEl ? jockeyEl.dataset.id : "JOCKEY NON ASSIGNÉ",
                    entraineur: entraineurEl ? entraineurEl.dataset.id : "ENTRAINEUR NON ASSIGNÉ",
                    proprietaire: proprietaire,
                    cote: cote,
                    score: score,
                    performances: {
                        cheval: chevalPerformance,
                        jockey: jockeyPerformance,
                        entraineur: entraineurPerformance,
                        proprietaire: proprietairePerformance
                    },
                    historique: historique
                });
            });
            
            // Trier par score
            appData.resultsData.sort((a, b) => b.score - a.score);
            
            // Afficher les résultats
            displayResults();
            hideStatus();
        }
        
        // Afficher les résultats
        function displayResults() {
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = '';
            
            // Mettre à jour le titre de la course
            document.getElementById('course-title').textContent = appData.selectedCourse.name;
            
            // Créer une carte pour chaque résultat
            appData.resultsData.forEach((result, index) => {
                // Choisir la couleur en fonction du classement
                let scoreColor, borderColor;
                if (index === 0) {
                    scoreColor = 'var(--grass-green)';
                    borderColor = 'var(--grass-green)';
                } else if (index === 1) {
                    scoreColor = 'var(--black)';
                    borderColor = 'var(--grass-green)';
                } else if (index === 2) {
                    scoreColor = 'var(--gold)';
                    borderColor = 'var(--grass-green)';
                } else {
                    scoreColor = '#777';
                    borderColor = 'var(--grass-green)';
                }
                
                // Déterminer le sexe en texte
                let sexeText;
                switch(result.sexe) {
                    case 'M': sexeText = 'Mâle'; break;
                    case 'F': sexeText = 'Femelle'; break;
                    case 'H': sexeText = 'Hongre'; break;
                    default: sexeText = 'Inconnu';
                }
                
                // Générer une couleur de robe aléatoire
                const robes = ['bai', 'alezan', 'gris', 'noir', 'bai-brun'];
                const robe = robes[Math.floor(Math.random() * robes.length)];
                
                // Créer la carte
                const card = document.createElement('div');
                card.className = 'horse-card bg-white rounded-xl shadow-md overflow-hidden border-t-4';
                card.style.borderTopColor = borderColor;
                
                card.innerHTML = `
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">${result.nom}</h3>
                                <p class="text-gray-600 text-sm">${sexeText} ${robe} - ${result.age} ans</p>
                            </div>
                            <div class="text-white font-bold rounded-full h-12 w-12 flex items-center justify-center text-xl" style="background-color: ${scoreColor};">
                                ${result.score}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="text-sm">
                                <p class="text-gray-500">Jockey</p>
                                <p class="font-semibold text-gray-800">${result.jockey}</p>
                            </div>
                            <div class="text-sm">
                                <p class="text-gray-500">Entraîneur</p>
                                <p class="font-semibold text-gray-800">${result.entraineur}</p>
                            </div>
                            <div class="text-sm">
                                <p class="text-gray-500">Propriétaire</p>
                                <p class="font-semibold text-gray-800">${result.proprietaire}</p>
                            </div>
                            <div class="text-sm">
                                <p class="text-gray-500">Cote</p>
                                <p class="font-semibold text-gray-800">${result.cote}</p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Composantes du score</h4>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-600">Cheval</span>
                                    <div class="w-3/4 bg-gray-200 rounded-full h-2">
                                        <div class="h-2 rounded-full" style="width: ${result.performances.cheval}%; background-color: var(--grass-green);"></div>
                                    </div>
                                    <span class="text-xs font-semibold ml-2">${result.performances.cheval}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-600">Jockey</span>
                                    <div class="w-3/4 bg-gray-200 rounded-full h-2">
                                        <div class="h-2 rounded-full" style="width: ${result.performances.jockey}%; background-color: var(--black);"></div>
                                    </div>
                                    <span class="text-xs font-semibold ml-2">${result.performances.jockey}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-600">Entraîneur</span>
                                    <div class="w-3/4 bg-gray-200 rounded-full h-2">
                                        <div class="h-2 rounded-full" style="width: ${result.performances.entraineur}%; background-color: var(--gold);"></div>
                                    </div>
                                    <span class="text-xs font-semibold ml-2">${result.performances.entraineur}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-600">Propriétaire</span>
                                    <div class="w-3/4 bg-gray-200 rounded-full h-2">
                                        <div class="h-2 rounded-full" style="width: ${result.performances.proprietaire}%; background-color: var(--dark-green);"></div>
                                    </div>
                                    <span class="text-xs font-semibold ml-2">${result.performances.proprietaire}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Historique récent</h4>
                            <div class="flex space-x-2">
                                ${result.historique.map(place => {
                                    let bgColor, textColor;
                                    if (place === 1) {
                                        bgColor = 'var(--light-gold)';
                                        textColor = 'var(--black)';
                                    } else if (place === 2 || place === 3) {
                                        bgColor = 'var(--light-gold)';
                                        textColor = 'var(--black)';
                                    } else {
                                        bgColor = '#f3f4f6';
                                        textColor = '#4b5563';
                                    }
                                    
                                    return `<span class="text-xs font-semibold px-2 py-1 rounded" 
                                                  style="background-color: ${bgColor}; color: ${textColor};">${place}${place === 1 ? 'er' : 'e'}</span>`;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                resultsGrid.appendChild(card);
            });
            
            // Afficher la section des résultats
            document.getElementById('analysis-results').style.display = 'block';
            document.getElementById('analysis-results').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            // Mettre à jour les graphiques
            updateCharts();
        }
        
        // Mettre à jour les graphiques
        function updateCharts() {
            // Récupérer les données pour les graphiques
            const labels = appData.resultsData.map(result => result.nom);
            const scores = appData.resultsData.map(result => result.score);
            const chevaux = appData.resultsData.map(result => result.performances.cheval);
            const jockeys = appData.resultsData.map(result => result.performances.jockey);
            const entraineurs = appData.resultsData.map(result => result.performances.entraineur);
            const proprietaires = appData.resultsData.map(result => result.performances.proprietaire);
            
            // Graphique de comparaison des scores
            const scoresCtx = document.getElementById('scoresChart').getContext('2d');
            if (window.scoresChart) window.scoresChart.destroy();
            
            window.scoresChart = new Chart(scoresCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Score global',
                        data: scores,
                        backgroundColor: '#0b8043', // vert gazon
                        borderColor: '#085c2f', // vert foncé
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Graphique radar pour les top 3
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            if (window.performanceChart) window.performanceChart.destroy();
            
            // Limiter aux 3 premiers
            const topResults = appData.resultsData.slice(0, 3);
            
            window.performanceChart = new Chart(performanceCtx, {
                type: 'radar',
                data: {
                    labels: ['Performance Cheval', 'Performance Jockey', 'Performance Entraîneur', 'Performance Propriétaire', 'Adaptation Distance', 'Adaptation Terrain'],
                    datasets: topResults.map((result, index) => {
                        // Couleurs différentes pour chaque concurrent
                        const colors = [
                            { bg: 'rgba(11, 128, 67, 0.2)', border: '#0b8043' },  // vert
                            { bg: 'rgba(26, 26, 26, 0.2)', border: '#1a1a1a' },   // noir
                            { bg: 'rgba(212, 175, 55, 0.2)', border: '#d4af37' }  // or
                        ];
                        
                        // Données pour le graphique radar
                        return {
                            label: result.nom,
                            data: [
                                result.performances.cheval,
                                result.performances.jockey,
                                result.performances.entraineur,
                                result.performances.proprietaire,
                                getRandomValue(75, 95, 85),  // Adaptation Distance (simulée)
                                getRandomValue(75, 95, 85)   // Adaptation Terrain (simulée)
                            ],
                            backgroundColor: colors[index].bg,
                            borderColor: colors[index].border,
                            pointBackgroundColor: colors[index].border,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: colors[index].border
                        };
                    })
                },
                options: {
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 50,
                            suggestedMax: 100
                        }
                    }
                }
            });
            
            // Initialiser ou mettre à jour le graphique de tendances
            initTrendsChart();
        }
        
        function initTrendsChart() {
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            if (window.trendsChart) window.trendsChart.destroy();
            
            window.trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet'],
                    datasets: [
                        {
                            label: 'Taux de réussite prédictions',
                            data: [65, 68, 72, 75, 79, 82, 85],
                            fill: false,
                            borderColor: '#0b8043', // vert gazon
                            tension: 0.1
                        },
                        {
                            label: 'Score moyen chevaux gagnants',
                            data: [82, 84, 85, 86, 88, 90, 92],
                            fill: false,
                            borderColor: '#d4af37', // or
                            tension: 0.1
                        },
                        {
                            label: 'Score moyen chevaux perdants',
                            data: [70, 72, 71, 74, 73, 75, 76],
                            fill: false,
                            borderColor: '#1a1a1a', // noir
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 60,
                            max: 100
                        }
                    }
                }
            });
        }
        
        // Charger les données au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les données
            loadData();
            
            // Événement du bouton d'analyse
            document.getElementById('analyze-button').addEventListener('click', function() {
                const courseSelect = document.getElementById('course-select');
                if (courseSelect.value) {
                    document.getElementById('selection-participants').style.display = 'block';
                } else {
                    alert('Veuillez sélectionner une course');
                }
            });
        });
    </script>
</body>
</html>